generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Patrols {
  id           Int         @id @unique @default(autoincrement())
  password     String
  email        String      @unique
  name         String
  supervisorID Int?        @unique
  role         Role        @default(patrol)
  mobile       String
  amendments   Amendment[] @relation("submittedByPatrol")
  supervisor   Patrols?    @relation("patrolSupervisor", fields: [supervisorID], references: [id])
  patrol       Patrols?    @relation("patrolSupervisor")
  reports      Reports[]   @relation("writtenByPatrol")
  shifts       Shifts[]    @relation("logByPatrol")
  vehicles     Vehicles[]  @relation("belongToPatrol")
}

model Vehicles {
  id           Int         @id @unique @default(autoincrement())
  numberPlate  String      @unique
  registration String
  make         String
  model        String
  patrolID     Int
  inAmendment  Amendment[] @relation("isInAmendment")
  shifts       Shifts[]    @relation("isInShift")
  patrols      Patrols     @relation("belongToPatrol", fields: [patrolID], references: [id])
}

model Reports {
  id                 Int          @id @unique @default(autoincrement())
  title              String
  createdAt          DateTime     @default(now())
  location           String
  patrolID           Int
  reportIncidentType String
  patrols            Patrols      @relation("writtenByPatrol", fields: [patrolID], references: [id])
  incident           IncidentType @relation("isIncidentOfType", fields: [reportIncidentType], references: [incidentType])
}

model IncidentType {
  incidentType String    @id @unique
  description  String
  reports      Reports[] @relation("isIncidentOfType")
}

model Shifts {
  id                 Int         @default(autoincrement())
  type               logType
  expectedHours      Decimal?
  actualHours        Decimal?
  policeStationBase  String
  cpCallSign         String
  logPatrolId        Int
  otherPatrolsName   String
  vehicleId          Int
  hasLiveryOrSignage Boolean
  hasPoliceRadio     Boolean
  logAt              DateTime    @default(now())
  hasAmendment       Amendment[] @relation("belongToShift")
  patrols            Patrols     @relation("logByPatrol", fields: [logPatrolId], references: [id])
  vehicles           Vehicles    @relation("isInShift", fields: [vehicleId], references: [id])

  @@id([id, type])
}

model Amendment {
  id                 Int      @id @unique @default(autoincrement())
  shiftHoursChange   Decimal?
  policeStationBase  String?
  cpCallSign         String?
  amendmentPatrolId  Int
  vehicleId          Int
  hasLiveryOrSignage Boolean?
  hasPoliceRadio     Boolean?
  amendmentMadeAt    DateTime @default(now())
  otherPatrolsName   String?
  shiftId            Int
  shiftType          logType  @default(logOn)
  patrols            Patrols  @relation("submittedByPatrol", fields: [amendmentPatrolId], references: [id])
  logOn              Shifts   @relation("belongToShift", fields: [shiftId, shiftType], references: [id, type])
  vehicles           Vehicles @relation("isInAmendment", fields: [vehicleId], references: [id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model amendments {
  id          BigInt    @id
  created_at  DateTime? @db.Timestamptz(6)
  updated_at  DateTime? @db.Timestamptz(6)
  content     String
  subject     String
  member_id   BigInt
  user_id     BigInt
  patrol_id   BigInt
  district_id BigInt
  status      String
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model district_stats {
  id                BigInt    @id
  created_at        DateTime? @db.Timestamptz(6)
  updated_at        DateTime? @db.Timestamptz(6)
  district_id       BigInt
  year              BigInt
  month             BigInt
  vehicle_related   Int?      @db.SmallInt
  property_related  Int?      @db.SmallInt
  damaged_property  Int?      @db.SmallInt
  disorder_related  Int?      @db.SmallInt
  people_related    Int?      @db.SmallInt
  special_service   Int?      @db.SmallInt
  kms_travelled     Float?
  patrol_hours      Float?
  camera_hours      Float?
  training          Float?
  administration    Float?
  submitter_cpnz_id BigInt
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model districts {
  id         BigInt    @id
  created_at DateTime? @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)
  name       String    @unique
  email      String    @default("office@cpnz.org.nz")
  patrols    patrols[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model imports {
  id                 BigInt    @id
  created_at         DateTime? @db.Timestamp(6)
  updated_at         DateTime? @db.Timestamp(6)
  short_patrol_name  String
  live_entries       String
  list_but_no_card   String
  cpnz_id            String
  entry_date         String
  current_card_count String
  surname            String
  first_names        String
  known_as           String
  dob                String
  gender             String
  driver_licence     String
  vetting_date       String
  business           String
  home               String
  cellular           String
  address            String
  suburb             String
  city               String
  post_code          String
  email              String
  patroller          String
  coordinator        String
  secretary          String
  training_officer   String
  nationality        String
  language           String
  skills2            String
  skills3            String
  skills4            String
  skills5            String
  skills6            String
  patrol_name        String
  district           String
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model logs {
  id          BigInt    @id
  created_at  DateTime? @db.Timestamptz(6)
  updated_at  DateTime? @db.Timestamptz(6)
  user_id     BigInt
  user_email  String
  description String
  member_id   BigInt
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model member_documents {
  id            BigInt    @id
  created_at    DateTime? @db.Timestamptz(6)
  updated_at    DateTime? @db.Timestamptz(6)
  member_id     BigInt
  original_name String
  unique_id     String    @unique
  members       members   @relation(fields: [member_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model members {
  id                               BigInt             @id
  created_at                       DateTime?          @db.Timestamptz(6)
  updated_at                       DateTime?          @db.Timestamptz(6)
  active_member                    Int                @db.SmallInt
  patrol_id                        BigInt
  district_id                      BigInt
  cpnz_id                          BigInt
  surname                          String
  first_names                      String
  known_as                         String?
  date_of_birth                    String
  gender                           String
  nationality                      String
  driver_licence_number            String
  vetting_date                     String?
  business_phone                   String?
  home_phone                       String?
  mobile_phone                     String?
  address_line_1                   String
  suburb                           String
  city                             String
  post_code                        String
  email                            String?
  patroller                        Int                @db.SmallInt
  officer                          Int                @db.SmallInt
  officer_type                     String
  languages                        String?
  skills                           String?
  notes                            String?
  photo_id                         String
  constabulary                     Int                @default(1) @db.SmallInt
  qi                               String?
  status                           String             @default("active")
  officer_patroller                Int?               @db.SmallInt
  officer_patrol_leader_1          Int?               @db.SmallInt
  officer_patrol_leader_2          Int?               @db.SmallInt
  officer_secretary                Int?               @db.SmallInt
  officer_patrol_trainer           Int?               @db.SmallInt
  officer_avp1                     Int?               @db.SmallInt
  officer_avp2                     Int?               @db.SmallInt
  officer_health_and_safety        Int?               @db.SmallInt
  officer_patrol_member_other      Int?               @db.SmallInt
  officer_district_leader          Int?               @db.SmallInt
  officer_district_trainer         Int?               @db.SmallInt
  officer_district_support_officer Int?               @db.SmallInt
  officer_district_other           Int?               @db.SmallInt
  officer_cpnz_staff               Int?               @db.SmallInt
  officer_probationer              Int?               @db.SmallInt
  access_website                   Int?               @db.SmallInt
  trained                          Int                @default(0) @db.SmallInt
  new_nationality                  String             @default("Not known")
  treasurer                        Int?               @db.SmallInt
  member_documents                 member_documents[]
  patrols                          patrols            @relation(fields: [patrol_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model migrations {
  migration String
  batch     BigInt

  @@ignore
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model old_stats_migration_changes {
  id                BigInt    @id
  created_at        DateTime? @db.Timestamp(6)
  updated_at        DateTime? @db.Timestamp(6)
  stats_patrol_name String
  stats_callsign    String
  district          BigInt
  founded           BigInt
  active            String
  no_name_change    String
  new_name          String
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model old_stats_patrol_reference {
  id              BigInt    @id
  created_at      DateTime? @db.Timestamp(6)
  updated_at      DateTime? @db.Timestamp(6)
  old_stats_index BigInt
  current_index   BigInt
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model options {
  id                    BigInt    @id
  created_at            DateTime? @db.Timestamp(6)
  updated_at            DateTime? @db.Timestamp(6)
  last_issued_patrol_id BigInt
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model password_resets {
  email      String
  token      String    @id
  created_at DateTime? @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model patrol_documents {
  id            BigInt    @id
  created_at    DateTime? @db.Timestamptz(6)
  updated_at    DateTime? @db.Timestamptz(6)
  patrol_id     BigInt
  original_name String
  unique_id     String    @unique
  patrols       patrols   @relation(fields: [patrol_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model patrols {
  id               BigInt             @id
  created_at       DateTime?          @db.Timestamptz(6)
  updated_at       DateTime?          @db.Timestamptz(6)
  name             String
  active           Int                @db.SmallInt
  district_id      BigInt
  notes            String?
  call_sign        String?
  year_joined      String?
  email            String             @default("office@cpnz.org.nz")
  members          members[]
  patrol_documents patrol_documents[]
  districts        districts          @relation(fields: [district_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  police_liaisons  police_liaisons[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model police_liaisons {
  id         BigInt    @id
  created_at DateTime? @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)
  name       String
  patrol_id  BigInt
  email      String
  phone      String
  qi         String?
  rank       String?
  station    String?
  patrols    patrols   @relation(fields: [patrol_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model stats {
  id                BigInt    @id
  created_at        DateTime? @db.Timestamptz(6)
  updated_at        DateTime? @db.Timestamptz(6)
  patrol_id         BigInt
  year              Int       @db.SmallInt
  month             Int       @db.SmallInt
  vehicle_related   Int?      @db.SmallInt
  property_related  Int?      @db.SmallInt
  damaged_property  Int?      @db.SmallInt
  disorder_related  Int?      @db.SmallInt
  people_related    Int?      @db.SmallInt
  special_service   Int?      @db.SmallInt
  kms_travelled     Float?
  patrol_hours      Float?
  camera_hours      Float?
  training          Float?
  administration    Float?
  submitter_cpnz_id BigInt
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model stats_documents {
  id             BigInt?
  created_at     DateTime? @db.Timestamptz(6)
  updated_at     DateTime? @db.Timestamptz(6)
  document_label String
  original_name  String
  unique_id      String    @unique
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user_export {
  id         BigInt    @id
  created_at DateTime? @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)
  username   String
  password   String
  email      String
  first_name String
  last_name  String
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id             BigInt    @id
  email          String    @unique
  password       String
  access_level   String
  member_id      BigInt
  remember_token String?
  created_at     DateTime? @db.Timestamptz(6)
  updated_at     DateTime? @db.Timestamptz(6)
  district       BigInt?
  patrol         BigInt?
}

enum Role {
  patrol
  lead
  admin
}

enum logType {
  logOn
  logOff
}
